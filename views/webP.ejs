<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/webP.css">
    <title>SPARK - 우리의 스터디 파크</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="/dist/assets/main-DUs1nuyG.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Grandiflora+One&family=Gravitas+One&family=Nanum+Myeongjo&family=Song+Myung&display=swap"
        rel="stylesheet">
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
    <header class="header">
        <div class="logo"> <!--파비콘 클릭하면 메인페이지로-->
            <a href="/studyR/webP">
                <img src="favicon.png" alt="파비콘" class="favicon">
            </a>
            <div>
                <h1>SPARK</h1>
                <p>우리의 스터디 파크</p>
            </div>
        </div>
        <nav class="nav">
            <a href="/studyR/mypage">MYPAGE</a>
            <a href="/login">LOGOUT</a>
        </nav>
    </header>

    <main>
        <section class="carousel-section">
            <div class="carousel-wrapper">
                <button class="prev-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="carousel-images">
                    <!-- 사용방법, 플랫폼 홍보 글 등 슬라이드 홍보 배너 형식 -->
                    <img src="/Frame 1.png"/>
                    <img src="/Frame 2.png"/>
                    <img src="/Frame 3.png"/>
                </div>
                <button class="next-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="carousel-text">
                <h3>SPARK에서<br>새로운 팀원을 찾으세요!</h3>
                <p>관심 있는 프로젝트에 참여하거나<br>자신의 아이디어를 등록해보세요.</p>
            </div>
        </section>
        <section class="projects">
            <h2>모집 중인 스터디 및 프로젝트</h2>
            <!-- 자동검색기능 -->
             <input type="text" id="titleSearch" placeholder="스터디명 검색" autocomplete="off" />
            <div id="autocompleteList" class="autocomplete-list"></div>
            <button id="searchBtn">검색</button>
            <script>
            const searchInput = document.getElementById('titleSearch');
            const list = document.getElementById('autocompleteList');

            searchInput.addEventListener('input', async () => {
                const query = searchInput.value.trim();
                if (query.length === 0) {
                list.innerHTML = '';
                return;
                }

                const res = await fetch(`/studyR/autocomplete?query=${encodeURIComponent(query)}`);
                const matches = await res.json();

                list.innerHTML = matches.map(title => 
                `<div class="autocomplete-item" onclick="selectTitle('${title}')">${title}</div>`
                ).join('');
            });

            function selectTitle(title) {
                document.getElementById('titleSearch').value = title;
                document.getElementById('autocompleteList').innerHTML = '';
            }




            document.getElementById('searchBtn').addEventListener('click', () => {
            const query = document.getElementById('titleSearch').value.trim().toLowerCase();
            const studyCards = document.querySelectorAll('.project-card');

            studyCards.forEach(card => {
            const title = card.querySelector('strong').innerText.toLowerCase();
            if (title.includes(query)) {
                card.style.display = 'block'; // 일치하면 보이게
            } else {
                card.style.display = 'none'; // 아니면 숨김
            }
            });
        });
            </script>
            
            
            <!--필터기능-->
            <form action="/studyR/filter" method="get" class="filter-form" style="margin-bottom: 20px;">
            <label>기술 스택 입력:
            <input type="text" name="techstack" id="techstack" placeholder="예: React" />
            </label>

            <label>진행 방식:
                <select name="progress_method">
                <option value="">전체</option>
                <option value="온라인">온라인</option>
                <option value="오프라인">오프라인</option>
                </select>
            </label>

            <label>마감 조건:
                <input type="radio" name="deadline" value="future" checked> 마감 전
                <input type="radio" name="deadline" value="past"> 마감 후
            </label>

            <button type="submit">필터 적용</button>
            </form>
            
            <!-- <button class="filter-btn">필터 설정</button>-->
            

            <!-- <div class="project-list">
            <% if (studies.length === 0) { %>
                <p>조건에 맞는 스터디가 없습니다.</p>
            <% } else { %>
                <% studies.forEach(study => { %>
                    <a href="/studyR/studies/<%= study.id %>" style="text-decoration: none; color: inherit;">
                        <div class="project-card">
                        <strong><%= study.title %></strong><br/>
                         기술: <% try {
                          const techs = JSON.parse(study.techstack);
                          techs.forEach(t => { %>
                           <span><%= t.value %></span>
                        <% }) } catch(e) { %>
                        <%= study.techstack %>
                        <% } %> |
                         방식: <%= study.progress_method %> |
                         마감일: <%= study.deadline %>
                        </div>
                    </a>
                <% }) %>
            <% } %>
            </div> -->
            <div class="project-list">
  <% if (studies.length === 0) { %>
    <p>조건에 맞는 스터디가 없습니다.</p>
  <% } else { %>
    <% studies.forEach(study => { %>
      <a href="/studyR/studies/<%= study.id %>" style="text-decoration: none; color: inherit;">
        <div class="project-card">

          <!-- <% if (study.thumbnail) { %>
            <img src="/uploads/<%= study.thumbnail %>" alt="썸네일" style="width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px;" />
          <% } %> -->

          <strong><%= study.title %></strong><br/>
          기술:
          <% try {
            const techs = JSON.parse(study.techstack);
            techs.forEach(t => { %>
              <span><%= t.value %></span>
          <% }) } catch(e) { %>
            <%= study.techstack %>
          <% } %> |
          방식: <%= study.progress_method %> |
          마감일: <%= study.deadline %>
        </div>
      </a>
    <% }) %>
  <% } %>
</div>
        </section>
    </main>

    <script src="/webP.js"></script>
</body>

</html>