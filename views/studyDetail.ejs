<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/favicon.png" type="image/png">
  <title>
    <%= study.title %> - ìŠ¤í„°ë”” ìƒì„¸
  </title>
  <link rel="stylesheet" href="/stylesheets/studyDetail.css" />
  <link rel="stylesheet" href="/stylesheets/style.css" />

  <!--  Kakao Maps API (í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬ëœ í‚¤ ì‚¬ìš©) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9bf612da576ee8e19a44886a389d194d"></script>
</head>

<body>
  <header class="header">
    <div class="header-inner">


      <div class="logo"> <!--íŒŒë¹„ì½˜ í´ë¦­í•˜ë©´ ë©”ì¸í˜ì´ì§€ë¡œ-->
        <a href="/studyR/webP">
          <img src="/favicon.png" alt="íŒŒë¹„ì½˜" class="favicon">
        </a>
        <div>
          <h1>SPARK</h1>
          <p>ìš°ë¦¬ì˜ ìŠ¤í„°ë”” íŒŒí¬</p>
        </div>
      </div>
      <nav class="nav">
        <a href="/mypage">MYPAGE</a>
        <a href="/login">LOGOUT</a>
      </nav>
  </header>
  <div class="container">
    <div class="content">
      <div class="form-wrapper">
        <h2>
          <%= study.title %>
        </h2>

        <div class="info-label">ì„¤ëª…</div>
        <div class="info-value">
          <%- study.descriptionHtml %>
        </div>

        <div class="info-label">ê¸°ìˆ  ìŠ¤íƒ</div>
        <div class="info-value">
          <% let stack='' ; try { if (typeof study.techstack==='string' ) { stack=JSON.parse(study.techstack).map(t=>
            t.value).join(', ');
            } else if (Array.isArray(study.techstack)) {
            stack = study.techstack.map(t => t.value).join(', ');
            }
            } catch (e) { stack = '(íŒŒì‹± ì‹¤íŒ¨)'; }
            %>
            <%= stack %>
        </div>

        <div class="info-label">íŒ€ì› ìˆ˜</div>
        <div class="info-value">
          <%= study.team_size %>
        </div>

        <div class="info-label">ì§„í–‰ ë°©ì‹</div>
        <div class="info-value">
          <%= study.progress_method %>
        </div>

        <div class="info-label">ë§ˆê°ì¼</div>
        <div class="info-value">
          <%= study.deadline %>
        </div>

        <div class="info-label">ìš”êµ¬ì‚¬í•­</div>
        <div class="info-value">
          <%= study.requirements %>
        </div>

        <% if (study.location_lat && study.location_lng) { %>
          <div class="info-label" id="map-title">ğŸ“ëª¨ì„ ì¥ì†Œ</div>
          <div id="map" style="width: 100%; height: 350px; margin-top: 1rem;"></div>
          <% } %>

            <% if (typeof currentUserId !=='undefined' && study.writer==currentUserId) { %>
              <p><strong>ì´ ìŠ¤í„°ë””ëŠ” ë‚´ê°€ ì‘ì„±í•œ ê¸€ì´ì—ìš”. ì§ì ‘ ëª¨ì§‘ ì¤‘ì¸ ìŠ¤í„°ë””ì—ëŠ” ì§€ì›í•  ìˆ˜ ì—†ì–´ìš”!</strong></p>
              <% } else if (alreadyApplied) { %>
                <p><strong>ì§€ì› ì™„ë£Œ!</strong></p>
                <% } else { %>
                  <a href="/studyR/apply/<%= study.id %>/form" class="apply-btn">ì§€ì›í•˜ê¸°</a>
                  <% } %>
      </div>
    </div>
  </div>

  <script>
    function initMap() {
      const lat = parseFloat("<%= study.location_lat %>");
      const lng = parseFloat("<%= study.location_lng %>");
      console.log(" ì§€ë„ ì¢Œí‘œ:", lat, lng);

      const container = document.getElementById("map");
      const options = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
      };

      const map = new kakao.maps.Map(container, options);

      const marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map
      });
    }

    // Kakao SDKê°€ ë¡œë“œëœ í›„ ì‹¤í–‰
    window.onload = function () {
      if (typeof kakao !== 'undefined' && kakao.maps) {
        initMap();
      } else {
        console.error(" Kakao Maps SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      }
    };
  </script>


</body>

</html>