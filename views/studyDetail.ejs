<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title><%= study.title %> - ìŠ¤í„°ë”” ìƒì„¸</title>

  <!--  Kakao Maps API (í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬ëœ í‚¤ ì‚¬ìš©) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=<%= kakaoKey %>"></script>
</head>
<body>
  <h2><%= study.title %></h2>

  <p><strong>ì„¤ëª…:</strong> <%= study.description %></p>

  <p><strong>ê¸°ìˆ  ìŠ¤íƒ:</strong>
    <% 
      let stack = '';
      try {
        if (typeof study.techstack === 'string') {
          stack = JSON.parse(study.techstack).map(t => t.value).join(', ');
        } else if (Array.isArray(study.techstack)) {
          stack = study.techstack.map(t => t.value).join(', ');
        }
      } catch (e) { stack = '(íŒŒì‹± ì‹¤íŒ¨)'; }
    %>
    <%= stack %>
  </p>

  <p><strong>íŒ€ì› ìˆ˜:</strong> <%= study.team_size %></p>
  <p><strong>ì§„í–‰ ë°©ì‹:</strong> <%= study.progress_method %></p>
  <p><strong>ë§ˆê°ì¼:</strong> <%= study.deadline %></p>
  <p><strong>ìš”êµ¬ì‚¬í•­:</strong> <%= study.requirements %></p>
  <% if (study.location_lat && study.location_lng) { %>
    <p><strong>ëª¨ì„ì¥ì†Œ:</strong></p>
    <div id="map" style="width: 100%; height: 350px; margin-top: 1rem;"></div>
  <% } %>


 <% if (study.writer === currentUserId) { %>
  <p><strong>ì´ ìŠ¤í„°ë””ëŠ” ë‚´ê°€ ì‘ì„±í•œ ê¸€ì´ì—ìš”.<br/>ì§ì ‘ ëª¨ì§‘ ì¤‘ì¸ ìŠ¤í„°ë””ì—ëŠ” ì§€ì›í•  ìˆ˜ ì—†ì–´ìš”!</strong></p>
 <% } else if (alreadyApplied) { %>
  <p><strong>ì§€ì› ì™„ë£Œ!</strong></p>
 <% } else { %>
  <a href="/studyR/apply/<%= study.id %>/form">ì§€ì›í•˜ê¸°</a>
 <% } %>



  <script>
    function initMap() {
      const lat = parseFloat("<%= study.location_lat %>");
      const lng = parseFloat("<%= study.location_lng %>");
      console.log("ğŸ“ ì§€ë„ ì¢Œí‘œ:", lat, lng);

      const container = document.getElementById("map");
      const options = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
      };

      const map = new kakao.maps.Map(container, options);

      const marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map
      });
    }

    // Kakao SDKê°€ ë¡œë“œëœ í›„ ì‹¤í–‰
    window.onload = function () {
      if (typeof kakao !== 'undefined' && kakao.maps) {
        initMap();
      } else {
        console.error("âŒ Kakao Maps SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      }
    };
  </script>


</body>
</html>



