<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  
  <title>SPARK - 등록하기</title>
  <link rel="stylesheet" href="/dist/assets/main-DUs1nuyG.css" />
  <link rel="stylesheet" href="/stylesheets/studyEnroll.css">
  <link rel="icon" href="/favicon.png" type="image/png">
  
    <style>
  #map {
    width: 100%;
    height: 400px; /* 높이를 명시적으로 지정 */
  }
</style>
<title>좌표로 주소를 얻어내기</title>
    <style>
    .map_wrap {position:relative;width:100%;height:350px;}
    .title {font-weight:bold;display:block;}
    .hAddr {position:absolute;left:10px;top:10px;border-radius: 2px;background:#fff;background:rgba(255,255,255,0.8);z-index:1;padding:5px;}
    #centerAddr {display:block;margin-top:2px;font-weight: normal;}
    .bAddr {padding:5px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
    .map-cover {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 9999;
   /* 반드시 없애야 클릭 가능 */
  }
</style>

    
</head>
<body>
  <header class="header">
    <div class="logo">
      <a href="studyR/webP">
        <img src="/favicon.png" alt="로고" class="favicon">
      </a>
      <h1>ENROLL</h1>
    </div>
    <nav class="nav">
      <a href="/studyR/webP">MAIN</a>
      <a href="/studyR/login">LOGOUT</a>
    </nav>
  </header>
  <form id="studyForm" method="POST" action = "<%= study.id ? '/studyR/studies/edit/' + study.id : '/studyR/studies' %>" >
    <label>제목(스터디 명):</label><br />
    <input type="text" name="title" value="<%= study?.title || '' %>" required /><br /><br />

    <label>설명 (마크다운):</label><br />
    <div id="editor"><%= study?.description || '' %></div>
    <input type="hidden" name="description" id="description" /><br /><br />

    <label>기술스택 (태그 입력):</label><br />
    <input name="techstack" id="techstack" placeholder="기술스택 입력" value="<%= study?.techstack || '' %>" /><br /><br />

    <label>팀원 수:</label><br />
    <input type="number" name="team_size" min="1" value="<%= study?.team_size || '' %>" required /><br /><br />

    <label>진행 방식:</label><br />
    <select name="progress_method" required>
      <option value="" <%= !study?.progress_method ? 'selected' : '' %>>선택하세요</option>
      <option value="온라인" <%= study?.progress_method === '온라인' ? 'selected' : '' %>>온라인</option>
      <option value="오프라인" <%= study?.progress_method === '오프라인' ? 'selected' : '' %>>오프라인</option>
      <option value="혼합" <%= study?.progress_method === '혼합' ? 'selected' : '' %>>혼합</option>
    </select><br /><br />

    <label>마감일:</label><br />
    <input type="date" name="deadline" value="<%= study?.deadline || '' %>" required /><br /><br />

    <label>모집 조건:</label><br />
    <textarea name="requirements" rows="4" cols="50"><%= study?.requirements || '' %></textarea><br /><br />

    <label>팀 소개 이미지 / 포스터 (파일 업로드):</label><br />
    <input type="file" name="thumbnail" accept="image/*" /><br /><br />
  

    <label>스터디 장소 위치 등록 (지도 클릭):</label><br />
    <input type="text" id="keyword" name = "place" placeholder="예: 서울역" />


  <!-- 위도/경도 표시 및 숨겨진 필드 -->
  <!-- <p>위도: <span id="lat"></span> | 경도: <span id="lng"></span></p>
  <input type="text" name="location_lat" id="location_lat">
  <input type="text" name="location_lng" id="location_lng"> -->

  <!-- <div id="map" style="width:100%; height:300px;"></div> -->
<button type="submit" name="action" value="enroll" id="enroll">등록하기</button>
<button type="submit" name="action" value="upload" id= "upload" >메인업로드</button>
</form>
<div class="map_wrap">
    <div id="map" style="width:100%;height:300px;position:relative;overflow:hidden;"></div>
    <div class="hAddr">
        <span class="title">지도중심기준 행정동 주소정보</span>
        <span id="centerAddr"></span>
    </div>
</div>

  <!-- Kakao Maps API 로드 -->
    <!-- <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=<%=process.env.KAKAO_JAVASCRIPT_KEY %>"></script> -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=<%=process.env.KAKAO_JAVASCRIPT_KEY %>&libraries=services"></script>

    <script>
  var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
        level: 1 // 지도의 확대 레벨
    };  

// 지도를 생성합니다    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// 주소-좌표 변환 객체를 생성합니다
var geocoder = new kakao.maps.services.Geocoder();

const marker = new kakao.maps.Marker(); // 클릭한 위치를 표시할 마커입니다
const infowindow = new kakao.maps.InfoWindow({zindex:1}); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

let currentMarker = null; // 현재 마커를 추적할 변수

kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
    searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            const detailAddr = result[0].road_address
                ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>'
                : '';
            const jibunAddr = '<div>지번 주소 : ' + result[0].address.address_name + '</div>';

            const content = '<div class="bAddr">' +
                '<span class="title">법정동 주소정보</span>' + 
                detailAddr + jibunAddr +
                '</div>';

            // 이전 마커가 있다면 지도에서 제거
            if (currentMarker) {
                currentMarker.setMap(null);
            }

            // 새로운 마커 생성 및 지도에 표시
            const newMarker = new kakao.maps.Marker({
                position: mouseEvent.latLng,
                map: map
            });

            // 인포윈도우 표시
            infowindow.setContent(content);
            infowindow.open(map, newMarker);

            // 현재 마커를 업데이트
            currentMarker = newMarker;

            // 주소 텍스트 필드에 반영
            document.getElementById('keyword').value = result[0].address.address_name;
        }
    });
});


  
</script>

  <script type="module" src="/dist/assets/main-Dg6OCUqS.js"></script>

</body>
</html>