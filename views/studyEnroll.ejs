<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>스터디/프로젝트 모집 글 작성</title>
  
  <!-- toast-ui editor 스타일 -->
  <link rel="stylesheet" href="https://uicdn.toast.com/tui-editor/latest/tui-editor.css" />
  <link rel="stylesheet" href="https://uicdn.toast.com/tui-editor/latest/tui-editor-contents.css" />

  <!-- tagify 스타일 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" />

  <style>
    #map { width: 100%; height: 300px; margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>스터디/프로젝트 모집 글 작성</h1>

  <form id="studyForm" enctype="multipart/form-data" method="POST" action="/studies">
    <label>제목(스터디 명):</label><br />
    <input type="text" name="title" required /><br /><br />

    <label>설명 (마크다운):</label><br />
    <div id="editor"></div>
    <input type="hidden" name="description" id="description" /><br /><br />

    <label>기술스택 (태그 입력):</label><br />
    <input name="techstack" id="techstack" placeholder="기술스택 입력" /><br /><br />

    <label>팀원 수:</label><br />
    <input type="number" name="team_size" min="1" required /><br /><br />

    <label>진행 방식:</label><br />
    <select name="progress_method" required>
      <option value="">선택하세요</option>
      <option value="온라인">온라인</option>
      <option value="오프라인">오프라인</option>
      <option value="혼합">혼합</option>
    </select><br /><br />

    <label>마감일:</label><br />
    <input type="date" name="deadline" required /><br /><br />

    <label>모집 조건:</label><br />
    <textarea name="requirements" rows="4" cols="50"></textarea><br /><br />

    <label>팀 소개 이미지 / 포스터 (파일 업로드):</label><br />
    <input type="file" name="thumbnail" accept="image/*" /><br /><br />

    <label>스터디 장소 위치 등록 (지도 클릭):</label><br />
    <div id="map"></div>
    <input type="hidden" name="location_lat" id="location_lat" />
    <input type="hidden" name="location_lng" id="location_lng" />

    <button type="submit">등록하기</button>
  </form>

  <!-- toast-ui editor 스크립트 -->
  <script src="https://uicdn.toast.com/tui-editor/latest/tui-editor-Editor-all.min.js"></script>

  <!-- tagify 스크립트 -->
  <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>

  <!-- 카카오 지도 API (자신의 JS 키로 변경) -->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_JAVASCRIPT_KEY"></script>

  <script>
    // toast-ui editor 초기화
    const editor = new tui.Editor({
      el: document.querySelector('#editor'),
      initialEditType: 'markdown',
      previewStyle: 'vertical',
      height: '300px',
      usageStatistics: false,
    });

    // 폼 제출 전에 description hidden input에 마크다운 값 저장
    const form = document.getElementById('studyForm');
    form.addEventListener('submit', () => {
      document.getElementById('description').value = editor.getMarkdown();
    });

    // tagify 초기화
    const input = document.querySelector('input[name=techstack]');
    const tagify = new Tagify(input);

    // 카카오 지도 초기화
    var mapContainer = document.getElementById('map'),
        mapOption = {
          center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울 시청 좌표
          level: 5
        };
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var marker = new kakao.maps.Marker({
      position: map.getCenter()
    });
    marker.setMap(map);

    // 지도 클릭 이벤트로 위치 선택
    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
      var latlng = mouseEvent.latLng;

      marker.setPosition(latlng);

      document.getElementById('location_lat').value = latlng.getLat();
      document.getElementById('location_lng').value = latlng.getLng();
    });
  </script>
</body>
</html>
