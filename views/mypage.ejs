<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SPARK - MYPAGE</title>
  <link rel="stylesheet" href="/stylesheets/myapage.css">
  <link rel="icon" href="/favicon.png" type="image/png">
  <!-- ✅ FullCalendar CSS -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />

  <!-- ✅ FullCalendar JS (global 버전) -->
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/google-calendar.global.min.js'></script>
</head>
<body>
  <header class="header">
    <div class="logo">
      <img src="/favicon.png" alt="로고" class="favicon">
      <h1>MYPAGE</h1>
    </div>
    <nav class="nav">
      <a href="/studyR/webP">MAIN</a>
      <a href="/login">LOGOUT</a>
    </nav>
  </header>
  <main class="mypage-container">
    <section class="profile-box">
      <p class="profile-label">profile</p>
      <div class="profile-content">
        <div class="profile-img" id="profile-img"></div>
        <div class="profile-text">
          <p id="username">이름</p>
          <p id="email">@seoultech.ac.kr</p>
        </div>
      </div>
    </section>

    <section class="study-box">
      <p class="study-label">MY STUDY</p>
      <div class="filter-buttons">
      
          
      <a href="/studyR/mypage?filter=soon">마감 임박</a>
      <a href="/studyR/mypage?filter=approved">합격</a>
      <a href="/studyR/mypage?filter=pending">승인 대기</a>
    </div>
    </div>
      <ul class="study-list"> <!--이 부분이 study의 데이터에 있는 내용을 가져오는 것이다. 그래서 거기에 미리두면 될듯! 여러 스터디들을 -->
        <% studies.forEach(study=> { %>
          <li class="study-item">
            <strong>
              <%= study.title %>
            </strong><br>
            <div class="button-group">
              <!-- <form action="/studyR/studies/upload/<%= study.id %>" method="GET" style="display:inline;">
                <button type="submit" class="study-button delete-button">업로드</button> --> <!--업로드버튼을 마이페이지에서 만들지 아니면 등록페이지에서 만들지 고민..-->
              <form action="/studyR/studies/delete/<%= study.id %>" method="POST" style="display:inline;">
                <button type="submit" class="study-button delete-button">삭제</button>
              </form>
              <form action="/studyR/studies/edit/<%= study.id %>" method="GET" style="display:inline;">
                <button type="submit" class="study-button edit-button">수정</button>
              </form>
              <form action="/studyR/studies/manage/<%= study.id %>" method="GET" style="display:inline;">
                <button type="submit" class="study-button manage-button">지원자 관리</button>
              </form>

            </div>
          </li>
          <% }) %>
      </ul>

      <!-- 스터디 등록 -->
      <a class="new-study-btn" id="toStudyWrite">새로운 스터디 만들기</a>
    </section>

    <hr>
<section class="study-box">
  <p class="study-label"> 수강 중인 스터디</p>
  <ul class="study-list">
    <% ongoing.forEach(app => { %>
      <li class="study-item">
        <strong><%= app.studyTitle %></strong><br>
        상태: <%= app.status %>
      </li>
    <% }) %>
  </ul>

  <p class="study-label"> 대기 중 / 불합격</p>
  <ul class="study-list">
    <% pending.forEach(app => { %>
      <li class="study-item">
        <strong><%= app.studyTitle %></strong><br>
        상태: <%= app.status || "대기 중" %><br>
        <form action="/studyR/applications/delete/<%= app.studyId %>" method="POST">
          <button type="submit" class="study-button delete-button">삭제</button>
        </form>
      </li>
    <% }) %>
  </ul>
</section>
</main>
<h1>내 구글 캘린더 보기</h1>
<div id='calendar' style="max-width: 900px; margin: 0 auto;"></div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');

      const calendar = new FullCalendar.Calendar(calendarEl, {
  initialView: 'dayGridMonth',
  locale: 'ko',
  googleCalendarApiKey: 'YOUR_GOOGLE_API_KEY',
  events: {
    googleCalendarId: 'hyanglee0508d@gmail.com'
  },
  selectable: true, // 일정 선택 가능
  select: function(info) {
    const title = prompt('일정 제목을 입력하세요');
    if (title) {
      calendar.addEvent({
        title: title,
        start: info.startStr,
        end: info.endStr,
        allDay: info.allDay
      });

      // 🚨 여기서 Google Calendar API 호출해야 DB 반영됨
      // fetch('/add-google-event', {...})
    }
    calendar.unselect();
  },
  eventClick: function(info) {
    info.jsEvent.preventDefault();
    if (info.event.url) {
      window.open(info.event.url, '_blank');
    }
  }
});

      calendar.render();
    });
  </script>
</body>
</html>